<%= form_with(model: @plant) do |f| %>
  <%# Error Messages %>
  <% if @plant.errors.any? %>
    <div class="alert alert-danger" role="alert">
      <h4 class="alert-heading">
        <%= pluralize(@plant.errors.count, "error") %> prohibited this plant from being saved:
      </h4>
      <ul class="mb-0">
        <% @plant.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# Name Field %>
  <div class="mb-3">
    <%= f.label :name, class: "form-label" %>
    <%= f.text_field :name, class: "form-control", placeholder: "e.g., Tomato" %>
  </div>

  <%# Variety Field %>
  <div class="mb-3">
    <%= f.label :variety, class: "form-label" %>
    <%= f.text_field :variety, class: "form-control", placeholder: "e.g., Cherry Roma" %>
  </div>

  <%# Sowing Method Dropdown %>
  <div class="mb-3">
    <%= f.label :sowing_method, class: "form-label" %>
    <%= f.select :sowing_method,
                 Plant.sowing_methods.keys
                      .reject { |m| m == "fridge_stratify" }  # Hide unimplemented
                      .map { |m| [m.titleize.gsub("_", " "), m] },
                 { include_blank: "Select a method" },
                 class: "form-select" %>
    <div class="form-text">Choose how you'll start your seeds.</div>
  </div>

  <%# Plant Seeds Timing %>
    <fieldset class="mb-3">
      <legend class="form-label">
        Plant seeds
      </legend>

      <div class="row g-2">
        <div class="col-md-4">
          <%= f.label :plant_seeds_weeks, "Number of units before/after frost", class: "visually-hidden" %>
          <%= f.number_field :plant_seeds_weeks,
                          value: (@plant.plant_seeds_offset_days ? @plant.plant_seeds_offset_days.abs / 7 : nil),
                          class: "form-control",
                          placeholder: "6",
                          min: 0 %>
        </div>
        <div class="col-md-4">
          <%= f.label :plant_seeds_unit, "Unit (weeks or days)", class: "visually-hidden" %>
          <%= f.select :plant_seeds_unit,
                     [["weeks", "weeks"], ["days", "days"]],
                     { selected: "weeks" },
                     class: "form-select" %>
        </div>
        <div class="col-md-4">
          <%= f.label :plant_seeds_direction, "Relative to last frost (before or after)", class: "visually-hidden" %>
          <%= f.select :plant_seeds_direction,
                     [["before frost", "before"], ["after frost", "after"]],
                     { selected: @plant.plant_seeds_offset_days && @plant.plant_seeds_offset_days >= 0 ? "after" : "before" },
                     class: "form-select" %>
        </div>
    <div class="form-text">For indoor/outdoor start: usually before frost. For direct sow: usually after frost.</div>
  </div>

  <%# Hardening Timing %>
    <fieldset class="mb-3">
      <legend class="form-label">
        Begin hardening off
      </legend>
      
      <div class="row g-2">
        <div class="col-md-4">
          <%= f.label :hardening_weeks, "Number of units before/after frost", class: "visually-hidden" %>
          <%= f.number_field :hardening_weeks,
                          value: (@plant.hardening_offset_days ? @plant.hardening_offset_days.abs / 7 : nil),
                          class: "form-control",
                          placeholder: "2",
                          min: 0 %>
       </div>
       <div class="col-md-4">
         <%= f.label :hardening_unit, "Unit (weeks or days)", class: "visually-hidden" %>
         <%= f.select :hardening_unit,
                     [["weeks", "weeks"], ["days", "days"]],
                     { selected: "weeks" },
                     class: "form-select" %>
         </div>
         <div class="col-md-4">
           <%= f.label :hardening_direction, "Relative to last frost (before or after)", class: "visually-hidden" %>
           <%= f.select :hardening_direction,
                     [["before frost", "before"], ["after frost", "after"]],
                     { selected: "before" },
                     class: "form-select" %>
        </div>
    <div class="form-text">Only needed for indoor start.</div>
  </div>

  <%# Plant Seedlings Timing %>
    <fieldset class="mb-3">
      <legend class="form-label">
        Transplant seedlings
      </legend>

      <div class="row g-2">
        <div class="col-md-4">
          <%= f.label :plant_seedlings_weeks, "Number of units before/after frost", class: "visually-hidden" %>
          <%= f.number_field :plant_seedlings_weeks,
                          value: (@plant.plant_seedlings_offset_days ? @plant.plant_seedlings_offset_days.abs / 7 : nil),
                          class: "form-control",
                          placeholder: "2",
                          min: 0 %>
        </div>
        <div class="col-md-4">
          <%= f.label :plant_seedlings_unit, "Unit (weeks or days)", class: "visually-hidden" %>
          <%= f.select :plant_seedlings_unit,
                     [["weeks", "weeks"], ["days", "days"]],
                     { selected: "weeks" },
                     class: "form-select" %>
        </div>
        <div class="col-md-4">
          <%= f.label :plant_seedlings_direction, "Relative to last frost (before or after)", class: "visually-hidden" %>
          <%= f.select :plant_seedlings_direction,
                     [["before frost", "before"], ["after frost", "after"]],
                     { selected: "after" },
                     class: "form-select" %>
      </div>
    <div class="form-text">Not needed for direct sow.</div>
  </div>

  <%# Notes Textarea %>
  <div class="mb-3">
    <%= f.label :notes, class: "form-label" %>
    <%= f.text_area :notes, rows: 4, class: "form-control", placeholder: "Add any special growing notes..." %>
  </div>

  <%# Submit Button %>
  <div class="d-grid gap-2 d-md-flex">
    <%= f.submit class: "btn btn-primary" %>
    <%= link_to "Cancel", plants_path, class: "btn btn-outline-secondary" %>
  </div>
<% end %>
